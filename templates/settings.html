{% extends 'base.html' %}
{% load static %}

{% block title %}ChatterChums - Settings{% endblock %}

{% block content %}
    <div class="settings-container">
        <h1>Settings</h1>
        <div class="settings-info">
            <h2>Appearance</h2>
            <div class="setting-item">
                <span>Dark Mode</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle" {% if request.theme == 'dark' %}checked{% endif %}>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize dark mode toggle based on theme cookie
            const darkModeToggle = document.getElementById('darkModeToggle');

            darkModeToggle.addEventListener('change', function () {
                const theme = this.checked ? 'dark' : 'light';

                // Apply the theme immediately to the UI
                if (this.checked) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }

                // Set the cookie via fetch API without page reload
                fetch(`{% url 'users:settings' %}?theme=${theme}`, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });

                // Update localStorage for backward compatibility
                localStorage.setItem('darkMode', this.checked ? 'enabled' : 'disabled');
            });
        });
    </script>
{% endblock %}